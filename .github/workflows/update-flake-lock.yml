name: Update Nix Flake lockfile

on:
  # Enable option to manually run the action:
  workflow_dispatch:

  # Run every Sunday at 00:00:
  schedule:
    - cron: 0 0 * * 0

jobs:
  update-flake-lock:
    uses: ./.github/workflows/reusable-update-flake-lock.yml
    secrets:
      NIX_GITHUB_TOKEN: ${{ github.token }}
      CACHIX_AUTH_TOKEN: ${{ secrets.CACHIX_AUTH_TOKEN }}
      CREATE_PR_APP_ID: ${{ secrets.CREATE_PR_APP_ID }}
      CREATE_PR_APP_PRIVATE_KEY: ${{ secrets.CREATE_PR_APP_PRIVATE_KEY }}
      GIT_GPG_SIGNING_SECRET_KEY: ${{ secrets.GIT_GPG_SIGNING_SECRET_KEY }}
      GIT_GPG_SIGNING_PASSPHRASE: ${{ secrets.GIT_GPG_SIGNING_PASSPHRASE }}
    with:
      runner: '["self-hosted", "Linux", "x86-64-v2"]'
      sign-commits: true
